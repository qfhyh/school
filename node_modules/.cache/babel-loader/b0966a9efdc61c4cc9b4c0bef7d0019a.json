{"remainingRequest":"E:\\QF\\H5-vue\\school\\node_modules\\thread-loader\\dist\\cjs.js!E:\\QF\\H5-vue\\school\\node_modules\\babel-loader\\lib\\index.js!E:\\QF\\H5-vue\\school\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!E:\\QF\\H5-vue\\school\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\QF\\H5-vue\\school\\src\\views\\application\\apartment\\apartmentVisitor.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\QF\\H5-vue\\school\\src\\views\\application\\apartment\\apartmentVisitor.vue","mtime":1542795827192},{"path":"E:\\QF\\H5-vue\\school\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1535070530521},{"path":"E:\\QF\\H5-vue\\school\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1535070532181},{"path":"E:\\QF\\H5-vue\\school\\node_modules\\babel-loader\\lib\\index.js","mtime":1539569622495},{"path":"E:\\QF\\H5-vue\\school\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1535070530521},{"path":"E:\\QF\\H5-vue\\school\\node_modules\\vue-loader\\lib\\index.js","mtime":1539569642393}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.array.for-each\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"E:\\\\QF\\\\H5-vue\\\\school\\\\node_modules\\\\@vue\\\\babel-preset-app\\\\node_modules\\\\@babel\\\\runtime/helpers/builtin/es6/asyncToGenerator\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { getCurrSchoolInfoList, selectGongYuBuild, asynchronousLoadingFloor, getRooms, selectList, getVisitor, jPush } from '@/services/apartment';\nimport uploadImg from '@/components/upload/uploadImg.vue';\nexport default {\n  name: 'apartmentVisitor',\n  data: function data() {\n    return {\n      visible: false,\n      sCampus: '请选择',\n      sApartment: '请选择',\n      sFloor: '请选择',\n      sDorm: '请选择',\n      sPerson: '请选择',\n      sTime: '请选择',\n      campus: false,\n      apartment: false,\n      floor: false,\n      dorm: false,\n      person: false,\n      time: false,\n      minDate: new Date(),\n      campusData: [],\n      apartmentData: [],\n      floorData: [],\n      dormData: [],\n      personData: [],\n      campusList: [],\n      apartmentList: [],\n      floorList: [],\n      dormList: [],\n      personList: [],\n      schoolId: '',\n      buildingId: '',\n      floorId: '',\n      roomId: '',\n      takeGoods: '',\n      visitorData: {\n        schoolId: '',\n        schoolName: '',\n        buildId: '',\n        buildName: '',\n        floolId: '',\n        floolName: '',\n        roomId: '',\n        roomName: '',\n        stuId: '',\n        stuName: '',\n        takeGoods: '',\n        visitTime: '',\n        photo: ''\n      },\n      photoList: [],\n      jPushData: {\n        userId: '',\n        mk: 'susfangke',\n        message: ''\n      },\n      jPushTime: null\n    };\n  },\n  components: {\n    uploadImg: uploadImg\n  },\n  methods: {\n    onClickLeft: function onClickLeft() {\n      this.$router.go(-1);\n    },\n    confirm: function confirm(value) {\n      this.time = false;\n      this.sTime = value.toLocaleString('chinese', {\n        hour12: false\n      });\n      this.jPushTime = this.$moment(value).format('YYYY年MM月DD日HH时mm分');\n    },\n    getCampus: function () {\n      var _getCampus = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee() {\n        var _this = this;\n\n        var _ref, data;\n\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return getCurrSchoolInfoList();\n\n              case 2:\n                _ref = _context.sent;\n                data = _ref.data;\n                this.campusData = data;\n                this.campusData.forEach(function (element) {\n                  _this.campusList.push(element.xXMC);\n                });\n\n              case 6:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      return function getCampus() {\n        return _getCampus.apply(this, arguments);\n      };\n    }(),\n    selectCampus: function selectCampus(value) {\n      var _this2 = this;\n\n      this.campus = false;\n      this.sCampus = value;\n      this.sApartment = '请选择';\n      this.sFloor = '请选择';\n      this.sDorm = '请选择';\n      this.sPerson = '请选择';\n      this.apartmentList = [];\n      this.floorList = [];\n      this.dormList = [];\n      this.personList = [];\n      this.campusData.forEach(function (element) {\n        if (element.xXMC === value) {\n          _this2.schoolId = element.id;\n          _this2.visitorData.schoolId = element.id;\n          _this2.visitorData.schoolName = value;\n        }\n      });\n      this.getApartment();\n    },\n    getApartment: function () {\n      var _getApartment = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee2() {\n        var _this3 = this;\n\n        var _ref2, data;\n\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return selectGongYuBuild(this.schoolId);\n\n              case 2:\n                _ref2 = _context2.sent;\n                data = _ref2.data;\n                this.apartmentData = data;\n                this.apartmentData.forEach(function (element) {\n                  _this3.apartmentList.push(element.mC);\n                });\n\n              case 6:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      return function getApartment() {\n        return _getApartment.apply(this, arguments);\n      };\n    }(),\n    selectApartment: function selectApartment(value) {\n      var _this4 = this;\n\n      this.apartment = false;\n      this.sApartment = value;\n      this.sFloor = '请选择';\n      this.sDorm = '请选择';\n      this.sPerson = '请选择';\n      this.floorList = [];\n      this.dormList = [];\n      this.personList = [];\n      this.apartmentData.forEach(function (element) {\n        if (element.mC === value) {\n          _this4.buildingId = element.id;\n          _this4.visitorData.buildId = _this4.buildingId;\n          _this4.visitorData.buildName = value;\n        }\n      });\n      this.getFloor();\n    },\n    getFloor: function () {\n      var _getFloor = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee3() {\n        var _this5 = this;\n\n        var _ref3, data;\n\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return asynchronousLoadingFloor(this.buildingId);\n\n              case 2:\n                _ref3 = _context3.sent;\n                data = _ref3.data;\n                this.floorData = data;\n                this.floorData.forEach(function (element) {\n                  _this5.floorList.push(element.name);\n                });\n\n              case 6:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      return function getFloor() {\n        return _getFloor.apply(this, arguments);\n      };\n    }(),\n    selectFloor: function selectFloor(value) {\n      var _this6 = this;\n\n      this.floor = false;\n      this.sFloor = value;\n      this.sDorm = '请选择';\n      this.sPerson = '请选择';\n      this.dormList = [];\n      this.personList = [];\n      this.floorData.forEach(function (element) {\n        if (element.name === value) {\n          _this6.floorId = element.id;\n          _this6.visitorData.floolId = _this6.floorId;\n          _this6.visitorData.floolName = value;\n        }\n      });\n      this.getDorm();\n    },\n    getDorm: function () {\n      var _getDorm = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee4() {\n        var _this7 = this;\n\n        var _ref4, data;\n\n        return regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.next = 2;\n                return getRooms(this.floorId);\n\n              case 2:\n                _ref4 = _context4.sent;\n                data = _ref4.data;\n                this.dormData = data;\n                this.dormData.forEach(function (element) {\n                  _this7.dormList.push(element.name);\n                });\n\n              case 6:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      return function getDorm() {\n        return _getDorm.apply(this, arguments);\n      };\n    }(),\n    selectDorm: function selectDorm(value) {\n      var _this8 = this;\n\n      this.dorm = false;\n      this.sDorm = value;\n      this.sPerson = '请选择';\n      this.personList = [];\n      this.dormData.forEach(function (element) {\n        if (element.name === value) {\n          _this8.roomId = element.id;\n          _this8.visitorData.roomId = _this8.roomId;\n          _this8.visitorData.roomName = value;\n        }\n      });\n      this.getPerson();\n    },\n    getPerson: function () {\n      var _getPerson = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee5() {\n        var _this9 = this;\n\n        var _ref5, data;\n\n        return regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _context5.next = 2;\n                return selectList(this.roomId);\n\n              case 2:\n                _ref5 = _context5.sent;\n                data = _ref5.data;\n                this.personData = data;\n                this.personData.forEach(function (element) {\n                  _this9.personList.push(element.userName);\n                });\n\n              case 6:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      return function getPerson() {\n        return _getPerson.apply(this, arguments);\n      };\n    }(),\n    selectPerson: function selectPerson(value) {\n      var _this10 = this;\n\n      this.person = false;\n      this.sPerson = value;\n      this.personData.forEach(function (element) {\n        if (element.userName === value) {\n          _this10.stuId = element.userId;\n          _this10.visitorData.stuId = _this10.stuId;\n          _this10.visitorData.stuName = value;\n          _this10.jPushData.userId = _this10.stuId;\n        }\n      });\n    },\n    postVisitor: function () {\n      var _postVisitor = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee6() {\n        var data;\n        return regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                this.jPushData.message = \"\".concat(this.jPushTime, \"\\uFF0C\\u5728\").concat(this.visitorData.buildName, \"\\u516C\\u5BD3\\u60A8\\u6709\\u4E00\\u4E2A\\u8BBF\\u5BA2\\u3002\");\n                _context6.next = 3;\n                return getVisitor(this.visitorData);\n\n              case 3:\n                data = _context6.sent;\n\n                if (data.httpCode === 200 || '200') {\n                  this.$toast.success('提交成功！');\n                  this.$router.go(-1);\n                } else {\n                  this.$toast.fail('提交失败！');\n                }\n\n                _context6.next = 7;\n                return jPush(this.jPushData);\n\n              case 7:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n\n      return function postVisitor() {\n        return _postVisitor.apply(this, arguments);\n      };\n    }(),\n    imgData: function imgData(data) {\n      var _this11 = this;\n\n      data.filePrikeys.forEach(function (element) {\n        _this11.photoList.push(element.filePath);\n      });\n    },\n    submitVisitor: function submitVisitor() {\n      this.visitorData.takeGoods = this.takeGoods;\n      this.visitorData.visitTime = this.sTime;\n      this.visitorData.photo = this.photoList.join(',');\n\n      if (this.visitorData.schoolName === '') {\n        this.$toast('请选择校区！');\n        return;\n      }\n\n      if (this.visitorData.buildName === '') {\n        this.$toast('请选择公寓楼！');\n        return;\n      }\n\n      if (this.visitorData.floolName === '') {\n        this.$toast('请选择楼层！');\n        return;\n      }\n\n      if (this.visitorData.roomName === '') {\n        this.$toast('请选择宿舍！');\n        return;\n      }\n\n      if (this.visitorData.stuName === '') {\n        this.$toast('请选择拜访人！');\n        return;\n      }\n\n      if (this.visitorData.checkTime === '') {\n        this.$toast('请选择检查时间！');\n        return;\n      }\n\n      this.postVisitor();\n    }\n  },\n  mounted: function mounted() {\n    this.getCampus();\n  }\n};",{"version":3,"sources":["apartmentVisitor.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <div class=\"apartmentVisitor\">\r\n    <van-nav-bar\r\n      title=\"访客登记\"\r\n      left-text=\"返回\"\r\n      right-text=\" \"\r\n      left-arrow\r\n      fixed\r\n      @click-left=\"onClickLeft\"/>\r\n      <div class=\"top\">\r\n        <van-cell-group>\r\n          <van-popup v-model=\"visible\" >\r\n\r\n          </van-popup>\r\n          <van-cell title=\"校区\" @click=\"campus = true;\" is-link border required\r\n           v-model=\"sCampus\"/>\r\n          <van-popup v-model=\"campus\" position=\"bottom\">\r\n            <van-picker show-toolbar title=\"校区\" :columns=\"campusList\"\r\n             @confirm=\"selectCampus\" @cancel=\"campus = false;\"/>\r\n          </van-popup>\r\n          <van-cell title=\"公寓\" @click=\"apartment = true;\" is-link border required\r\n           v-model=\"sApartment\" />\r\n          <van-popup v-model=\"apartment\" position=\"bottom\">\r\n            <van-picker show-toolbar title=\"公寓\" :columns=\"apartmentList\"\r\n             @confirm=\"selectApartment\" @cancel=\"apartment = false;\"/>\r\n          </van-popup>\r\n          <van-cell title=\"楼层\" @click=\"floor = true;\" is-link border required\r\n           v-model=\"sFloor\" />\r\n          <van-popup v-model=\"floor\" position=\"bottom\">\r\n            <van-picker show-toolbar title=\"楼层\" :columns=\"floorList\"\r\n             @confirm=\"selectFloor\" @cancel=\"floor = false;\" />\r\n          </van-popup>\r\n          <van-cell title=\"宿舍\" @click=\"dorm = true;\" is-link border required v-model=\"sDorm\" />\r\n          <van-popup v-model=\"dorm\" position=\"bottom\">\r\n            <van-picker show-toolbar title=\"宿舍\" :columns=\"dormList\"\r\n             @confirm=\"selectDorm\" @cancel=\"dorm = false;\" />\r\n          </van-popup>\r\n          <van-cell title=\"拜访人\" @click=\"person = true;\" is-link border required v-model=\"sPerson\" />\r\n          <van-popup v-model=\"person\" position=\"bottom\">\r\n            <van-picker show-toolbar title=\"拜访人\" :columns=\"personList\"\r\n             @confirm=\"selectPerson\" @cancel=\"person = false;\" />\r\n          </van-popup>\r\n          <van-cell title=\"来访时间\" @click=\"time = true;\" is-link border required v-model=\"sTime\" />\r\n          <van-popup v-model=\"time\" position=\"bottom\">\r\n            <van-datetime-picker\r\n              show-toolbar\r\n              @confirm=\"confirm\"\r\n              @cancel=\"time = false\"\r\n              type=\"datetime\"\r\n              :min-date=\"minDate\"/>\r\n          </van-popup>\r\n          <van-field v-model=\"takeGoods\" label=\"携带物品\" type=\"textarea\" placeholder=\"请输入\"\r\n           rows=\"1\" autosize />\r\n          <van-cell value=\"添加图片\" />\r\n          <upload-img v-on:imgData=\"imgData\"></upload-img>\r\n        </van-cell-group>\r\n      </div>\r\n    <div class=\"btn-group\">\r\n      <van-button round size=\"large\" class=\"btn blue\" @click=\"submitVisitor\">提交</van-button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { getCurrSchoolInfoList, selectGongYuBuild, asynchronousLoadingFloor, getRooms, selectList, getVisitor, jPush } from '@/services/apartment';\r\nimport uploadImg from '@/components/upload/uploadImg.vue';\r\n\r\nexport default {\r\n  name: 'apartmentVisitor',\r\n  data() {\r\n    return {\r\n      visible: false,\r\n      sCampus: '请选择',\r\n      sApartment: '请选择',\r\n      sFloor: '请选择',\r\n      sDorm: '请选择',\r\n      sPerson: '请选择',\r\n      sTime: '请选择',\r\n      campus: false,\r\n      apartment: false,\r\n      floor: false,\r\n      dorm: false,\r\n      person: false,\r\n      time: false,\r\n      minDate: new Date(),\r\n      campusData: [],\r\n      apartmentData: [],\r\n      floorData: [],\r\n      dormData: [],\r\n      personData: [],\r\n      campusList: [],\r\n      apartmentList: [],\r\n      floorList: [],\r\n      dormList: [],\r\n      personList: [],\r\n      schoolId: '',\r\n      buildingId: '',\r\n      floorId: '',\r\n      roomId: '',\r\n      takeGoods: '',\r\n      visitorData: {\r\n        schoolId: '',\r\n        schoolName: '',\r\n        buildId: '',\r\n        buildName: '',\r\n        floolId: '',\r\n        floolName: '',\r\n        roomId: '',\r\n        roomName: '',\r\n        stuId: '',\r\n        stuName: '',\r\n        takeGoods: '',\r\n        visitTime: '',\r\n        photo: '',\r\n      },\r\n      photoList: [],\r\n      jPushData: {\r\n        userId: '',\r\n        mk: 'susfangke',\r\n        message: '',\r\n      },\r\n      jPushTime: null,\r\n    };\r\n  },\r\n  components: {\r\n    uploadImg,\r\n  },\r\n  methods: {\r\n    onClickLeft() {\r\n      this.$router.go(-1);\r\n    },\r\n    confirm(value) {\r\n      this.time = false;\r\n      this.sTime = value.toLocaleString('chinese', { hour12: false });\r\n      this.jPushTime = this.$moment(value).format('YYYY年MM月DD日HH时mm分');\r\n    },\r\n    async getCampus() {\r\n      const { data } = await getCurrSchoolInfoList();\r\n      this.campusData = data;\r\n      this.campusData.forEach((element) => {\r\n        this.campusList.push(element.xXMC);\r\n      });\r\n    },\r\n    selectCampus(value) {\r\n      this.campus = false;\r\n      this.sCampus = value;\r\n      this.sApartment = '请选择';\r\n      this.sFloor = '请选择';\r\n      this.sDorm = '请选择';\r\n      this.sPerson = '请选择';\r\n      this.apartmentList = [];\r\n      this.floorList = [];\r\n      this.dormList = [];\r\n      this.personList = [];\r\n      this.campusData.forEach((element) => {\r\n        if (element.xXMC === value) {\r\n          this.schoolId = element.id;\r\n          this.visitorData.schoolId = element.id;\r\n          this.visitorData.schoolName = value;\r\n        }\r\n      });\r\n      this.getApartment();\r\n    },\r\n    async getApartment() {\r\n      const { data } = await selectGongYuBuild(this.schoolId);\r\n      this.apartmentData = data;\r\n      this.apartmentData.forEach((element) => {\r\n        this.apartmentList.push(element.mC);\r\n      });\r\n    },\r\n    selectApartment(value) {\r\n      this.apartment = false;\r\n      this.sApartment = value;\r\n      this.sFloor = '请选择';\r\n      this.sDorm = '请选择';\r\n      this.sPerson = '请选择';\r\n      this.floorList = [];\r\n      this.dormList = [];\r\n      this.personList = [];\r\n      this.apartmentData.forEach((element) => {\r\n        if (element.mC === value) {\r\n          this.buildingId = element.id;\r\n          this.visitorData.buildId = this.buildingId;\r\n          this.visitorData.buildName = value;\r\n        }\r\n      });\r\n      this.getFloor();\r\n    },\r\n    async getFloor() {\r\n      const { data } = await asynchronousLoadingFloor(this.buildingId);\r\n      this.floorData = data;\r\n      this.floorData.forEach((element) => {\r\n        this.floorList.push(element.name);\r\n      });\r\n    },\r\n    selectFloor(value) {\r\n      this.floor = false;\r\n      this.sFloor = value;\r\n      this.sDorm = '请选择';\r\n      this.sPerson = '请选择';\r\n      this.dormList = [];\r\n      this.personList = [];\r\n      this.floorData.forEach((element) => {\r\n        if (element.name === value) {\r\n          this.floorId = element.id;\r\n          this.visitorData.floolId = this.floorId;\r\n          this.visitorData.floolName = value;\r\n        }\r\n      });\r\n      this.getDorm();\r\n    },\r\n    async getDorm() {\r\n      const { data } = await getRooms(this.floorId);\r\n      this.dormData = data;\r\n      this.dormData.forEach((element) => {\r\n        this.dormList.push(element.name);\r\n      });\r\n    },\r\n    selectDorm(value) {\r\n      this.dorm = false;\r\n      this.sDorm = value;\r\n      this.sPerson = '请选择';\r\n      this.personList = [];\r\n      this.dormData.forEach((element) => {\r\n        if (element.name === value) {\r\n          this.roomId = element.id;\r\n          this.visitorData.roomId = this.roomId;\r\n          this.visitorData.roomName = value;\r\n        }\r\n      });\r\n      this.getPerson();\r\n    },\r\n    async getPerson() {\r\n      const { data } = await selectList(this.roomId);\r\n      this.personData = data;\r\n      this.personData.forEach((element) => {\r\n        this.personList.push(element.userName);\r\n      });\r\n    },\r\n    selectPerson(value) {\r\n      this.person = false;\r\n      this.sPerson = value;\r\n      this.personData.forEach((element) => {\r\n        if (element.userName === value) {\r\n          this.stuId = element.userId;\r\n          this.visitorData.stuId = this.stuId;\r\n          this.visitorData.stuName = value;\r\n          this.jPushData.userId = this.stuId;\r\n        }\r\n      });\r\n    },\r\n    async postVisitor() {\r\n      this.jPushData.message = `${this.jPushTime}，在${this.visitorData.buildName}公寓您有一个访客。`;\r\n      const data = await getVisitor(this.visitorData);\r\n      if (data.httpCode === 200 || '200') {\r\n        this.$toast.success('提交成功！');\r\n        this.$router.go(-1);\r\n      } else {\r\n        this.$toast.fail('提交失败！');\r\n      }\r\n      await jPush(this.jPushData);\r\n    },\r\n    imgData(data) {\r\n      data.filePrikeys.forEach((element) => {\r\n        this.photoList.push(element.filePath);\r\n      });\r\n    },\r\n    submitVisitor() {\r\n      this.visitorData.takeGoods = this.takeGoods;\r\n      this.visitorData.visitTime = this.sTime;\r\n      this.visitorData.photo = this.photoList.join(',');\r\n      if (this.visitorData.schoolName === '') {\r\n        this.$toast('请选择校区！');\r\n        return;\r\n      }\r\n      if (this.visitorData.buildName === '') {\r\n        this.$toast('请选择公寓楼！');\r\n        return;\r\n      }\r\n      if (this.visitorData.floolName === '') {\r\n        this.$toast('请选择楼层！');\r\n        return;\r\n      }\r\n      if (this.visitorData.roomName === '') {\r\n        this.$toast('请选择宿舍！');\r\n        return;\r\n      }\r\n      if (this.visitorData.stuName === '') {\r\n        this.$toast('请选择拜访人！');\r\n        return;\r\n      }\r\n      if (this.visitorData.checkTime === '') {\r\n        this.$toast('请选择检查时间！');\r\n        return;\r\n      }\r\n      this.postVisitor();\r\n    },\r\n  },\r\n  mounted() {\r\n    this.getCampus();\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.apartmentVisitor {\r\n  padding-top: 46px;\r\n}\r\n.btn-group{\r\n  padding: 0 38px;\r\n  margin: 20px 0;\r\n  .btn{\r\n      font-size: 17px;\r\n      margin: 0 auto 15px;\r\n      border-radius: 30px;\r\n      height: 6.8vh;\r\n      line-height: 6.8vh;\r\n      background-color: #FFFFFF;\r\n      color: #1890ff;\r\n      border: 1px solid #1890FF;\r\n  }\r\n  .blue{\r\n      background-color: #1890ff;\r\n      color: #FFFFFF;\r\n  }\r\n}\r\n</style>\r\n"],"sourceRoot":"src\\views\\application\\apartment"}]}