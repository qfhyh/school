{"remainingRequest":"E:\\vue\\school\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\vue\\school\\src\\views\\application\\apartment\\apartmentVisitor.vue?vue&type=style&index=0&id=edae465c&lang=scss&scoped=true&","dependencies":[{"path":"E:\\vue\\school\\src\\views\\application\\apartment\\apartmentVisitor.vue","mtime":1543196928000},{"path":"E:\\vue\\school\\node_modules\\css-loader\\index.js","mtime":1535070530000},{"path":"E:\\vue\\school\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1539569642000},{"path":"E:\\vue\\school\\node_modules\\postcss-loader\\lib\\index.js","mtime":1535070530000},{"path":"E:\\vue\\school\\node_modules\\sass-loader\\lib\\loader.js","mtime":1537144516000},{"path":"E:\\vue\\school\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1535070530000},{"path":"E:\\vue\\school\\node_modules\\vue-loader\\lib\\index.js","mtime":1539569642000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\n.apartmentVisitor {\r\n  padding-top: 46px;\r\n}\r\n.btn-group{\r\n  padding: 0 38px;\r\n  margin: 20px 0;\r\n  .btn{\r\n      font-size: 17px;\r\n      margin: 0 auto 15px;\r\n      border-radius: 30px;\r\n      height: 6.8vh;\r\n      line-height: 6.8vh;\r\n      background-color: #FFFFFF;\r\n      color: #1890ff;\r\n      border: 1px solid #1890FF;\r\n  }\r\n  .blue{\r\n      background-color: #1890ff;\r\n      color: #FFFFFF;\r\n  }\r\n}\r\n",{"version":3,"sources":["apartmentVisitor.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"apartmentVisitor.vue","sourceRoot":"src\\views\\application\\apartment","sourcesContent":["<template>\r\n  <div class=\"apartmentVisitor\">\r\n    <back-button></back-button>\r\n    <van-nav-bar\r\n      title=\"访客登记\"\r\n      left-text=\"返回\"\r\n      right-text=\" \"\r\n      left-arrow\r\n      fixed\r\n      @click-left=\"onClickLeft\"/>\r\n      <div class=\"top\">\r\n        <van-cell-group>\r\n          <van-popup v-model=\"visible\" >\r\n\r\n          </van-popup>\r\n          <van-cell title=\"校区\" @click=\"campus = true;\" is-link border required\r\n           v-model=\"sCampus\"/>\r\n          <van-popup v-model=\"campus\" position=\"bottom\">\r\n            <van-picker show-toolbar title=\"校区\" :columns=\"campusList\"\r\n             @confirm=\"selectCampus\" @cancel=\"campus = false;\"/>\r\n          </van-popup>\r\n          <van-cell title=\"公寓\" @click=\"apartment = true;\" is-link border required\r\n           v-model=\"sApartment\" />\r\n          <van-popup v-model=\"apartment\" position=\"bottom\">\r\n            <van-picker show-toolbar title=\"公寓\" :columns=\"apartmentList\"\r\n             @confirm=\"selectApartment\" @cancel=\"apartment = false;\"/>\r\n          </van-popup>\r\n          <van-cell title=\"楼层\" @click=\"floor = true;\" is-link border required\r\n           v-model=\"sFloor\" />\r\n          <van-popup v-model=\"floor\" position=\"bottom\">\r\n            <van-picker show-toolbar title=\"楼层\" :columns=\"floorList\"\r\n             @confirm=\"selectFloor\" @cancel=\"floor = false;\" />\r\n          </van-popup>\r\n          <van-cell title=\"宿舍\" @click=\"dorm = true;\" is-link border required v-model=\"sDorm\" />\r\n          <van-popup v-model=\"dorm\" position=\"bottom\">\r\n            <van-picker show-toolbar title=\"宿舍\" :columns=\"dormList\"\r\n             @confirm=\"selectDorm\" @cancel=\"dorm = false;\" />\r\n          </van-popup>\r\n          <van-cell title=\"拜访人\" @click=\"person = true;\" is-link border required v-model=\"sPerson\" />\r\n          <van-popup v-model=\"person\" position=\"bottom\">\r\n            <van-picker show-toolbar title=\"拜访人\" :columns=\"personList\"\r\n             @confirm=\"selectPerson\" @cancel=\"person = false;\" />\r\n          </van-popup>\r\n          <van-cell title=\"来访时间\" @click=\"time = true;\" is-link border required v-model=\"sTime\" />\r\n          <van-popup v-model=\"time\" position=\"bottom\">\r\n            <van-datetime-picker\r\n              show-toolbar\r\n              @confirm=\"confirm\"\r\n              @cancel=\"time = false\"\r\n              type=\"datetime\"\r\n              :min-date=\"minDate\"/>\r\n          </van-popup>\r\n          <van-field v-model=\"takeGoods\" label=\"携带物品\" type=\"textarea\" placeholder=\"请输入\"\r\n           rows=\"1\" autosize />\r\n          <van-cell value=\"添加图片\" />\r\n          <upload-img v-on:imgData=\"imgData\"></upload-img>\r\n        </van-cell-group>\r\n      </div>\r\n    <div class=\"btn-group\">\r\n      <van-button round size=\"large\" class=\"btn blue\" @click=\"submitVisitor\">提交</van-button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { getCurrSchoolInfoList, selectGongYuBuild, asynchronousLoadingFloor, getRooms, selectList, getVisitor, jPush } from '@/services/apartment';\r\nimport uploadImg from '@/components/upload/uploadImg.vue';\r\nimport backButton from '@/components/backButton/backButton.vue';\r\n\r\nexport default {\r\n  name: 'apartmentVisitor',\r\n  data() {\r\n    return {\r\n      visible: false,\r\n      sCampus: '请选择',\r\n      sApartment: '请选择',\r\n      sFloor: '请选择',\r\n      sDorm: '请选择',\r\n      sPerson: '请选择',\r\n      sTime: '请选择',\r\n      campus: false,\r\n      apartment: false,\r\n      floor: false,\r\n      dorm: false,\r\n      person: false,\r\n      time: false,\r\n      minDate: new Date(),\r\n      campusData: [],\r\n      apartmentData: [],\r\n      floorData: [],\r\n      dormData: [],\r\n      personData: [],\r\n      campusList: [],\r\n      apartmentList: [],\r\n      floorList: [],\r\n      dormList: [],\r\n      personList: [],\r\n      schoolId: '',\r\n      buildingId: '',\r\n      floorId: '',\r\n      roomId: '',\r\n      takeGoods: '',\r\n      visitorData: {\r\n        schoolId: '',\r\n        schoolName: '',\r\n        buildId: '',\r\n        buildName: '',\r\n        floolId: '',\r\n        floolName: '',\r\n        roomId: '',\r\n        roomName: '',\r\n        stuId: '',\r\n        stuName: '',\r\n        takeGoods: '',\r\n        visitTime: '',\r\n        photo: '',\r\n      },\r\n      photoList: [],\r\n      jPushData: {\r\n        userId: '',\r\n        mk: 'susfangke',\r\n        message: '',\r\n      },\r\n      jPushTime: null,\r\n    };\r\n  },\r\n  components: {\r\n    uploadImg,\r\n    backButton,\r\n  },\r\n  methods: {\r\n    onClickLeft() {\r\n      this.$router.go(-1);\r\n    },\r\n    confirm(value) {\r\n      this.time = false;\r\n      this.sTime = value.toLocaleString('chinese', { hour12: false });\r\n      this.jPushTime = this.$moment(value).format('YYYY年MM月DD日HH时mm分');\r\n    },\r\n    async getCampus() {\r\n      const { data } = await getCurrSchoolInfoList();\r\n      this.campusData = data;\r\n      this.campusData.forEach((element) => {\r\n        this.campusList.push(element.xXMC);\r\n      });\r\n    },\r\n    selectCampus(value) {\r\n      this.campus = false;\r\n      this.sCampus = value;\r\n      this.sApartment = '请选择';\r\n      this.sFloor = '请选择';\r\n      this.sDorm = '请选择';\r\n      this.sPerson = '请选择';\r\n      this.apartmentList = [];\r\n      this.floorList = [];\r\n      this.dormList = [];\r\n      this.personList = [];\r\n      this.campusData.forEach((element) => {\r\n        if (element.xXMC === value) {\r\n          this.schoolId = element.id;\r\n          this.visitorData.schoolId = element.id;\r\n          this.visitorData.schoolName = value;\r\n        }\r\n      });\r\n      this.getApartment();\r\n    },\r\n    async getApartment() {\r\n      const { data } = await selectGongYuBuild(this.schoolId);\r\n      this.apartmentData = data;\r\n      this.apartmentData.forEach((element) => {\r\n        this.apartmentList.push(element.mC);\r\n      });\r\n    },\r\n    selectApartment(value) {\r\n      this.apartment = false;\r\n      this.sApartment = value;\r\n      this.sFloor = '请选择';\r\n      this.sDorm = '请选择';\r\n      this.sPerson = '请选择';\r\n      this.floorList = [];\r\n      this.dormList = [];\r\n      this.personList = [];\r\n      this.apartmentData.forEach((element) => {\r\n        if (element.mC === value) {\r\n          this.buildingId = element.id;\r\n          this.visitorData.buildId = this.buildingId;\r\n          this.visitorData.buildName = value;\r\n        }\r\n      });\r\n      this.getFloor();\r\n    },\r\n    async getFloor() {\r\n      const { data } = await asynchronousLoadingFloor(this.buildingId);\r\n      this.floorData = data;\r\n      this.floorData.forEach((element) => {\r\n        this.floorList.push(element.name);\r\n      });\r\n    },\r\n    selectFloor(value) {\r\n      this.floor = false;\r\n      this.sFloor = value;\r\n      this.sDorm = '请选择';\r\n      this.sPerson = '请选择';\r\n      this.dormList = [];\r\n      this.personList = [];\r\n      this.floorData.forEach((element) => {\r\n        if (element.name === value) {\r\n          this.floorId = element.id;\r\n          this.visitorData.floolId = this.floorId;\r\n          this.visitorData.floolName = value;\r\n        }\r\n      });\r\n      this.getDorm();\r\n    },\r\n    async getDorm() {\r\n      const { data } = await getRooms(this.floorId);\r\n      this.dormData = data;\r\n      this.dormData.forEach((element) => {\r\n        this.dormList.push(element.name);\r\n      });\r\n    },\r\n    selectDorm(value) {\r\n      this.dorm = false;\r\n      this.sDorm = value;\r\n      this.sPerson = '请选择';\r\n      this.personList = [];\r\n      this.dormData.forEach((element) => {\r\n        if (element.name === value) {\r\n          this.roomId = element.id;\r\n          this.visitorData.roomId = this.roomId;\r\n          this.visitorData.roomName = value;\r\n        }\r\n      });\r\n      this.getPerson();\r\n    },\r\n    async getPerson() {\r\n      const { data } = await selectList(this.roomId);\r\n      this.personData = data;\r\n      this.personData.forEach((element) => {\r\n        this.personList.push(element.userName);\r\n      });\r\n    },\r\n    selectPerson(value) {\r\n      this.person = false;\r\n      this.sPerson = value;\r\n      this.personData.forEach((element) => {\r\n        if (element.userName === value) {\r\n          this.stuId = element.userId;\r\n          this.visitorData.stuId = this.stuId;\r\n          this.visitorData.stuName = value;\r\n          this.jPushData.userId = this.stuId;\r\n        }\r\n      });\r\n    },\r\n    async postVisitor() {\r\n      this.jPushData.message = `${this.jPushTime}，在${this.visitorData.buildName}公寓您有一个访客。`;\r\n      const data = await getVisitor(this.visitorData);\r\n      if (data.httpCode === 200 || '200') {\r\n        this.$toast.success('提交成功！');\r\n        this.$router.go(-1);\r\n      } else {\r\n        this.$toast.fail('提交失败！');\r\n      }\r\n      await jPush(this.jPushData);\r\n    },\r\n    imgData(data) {\r\n      data.filePrikeys.forEach((element) => {\r\n        this.photoList.push(element.filePath);\r\n      });\r\n    },\r\n    submitVisitor() {\r\n      this.visitorData.takeGoods = this.takeGoods;\r\n      this.visitorData.visitTime = this.sTime;\r\n      this.visitorData.photo = this.photoList.join(',');\r\n      if (this.visitorData.schoolName === '') {\r\n        this.$toast('请选择校区！');\r\n        return;\r\n      }\r\n      if (this.visitorData.buildName === '') {\r\n        this.$toast('请选择公寓楼！');\r\n        return;\r\n      }\r\n      if (this.visitorData.floolName === '') {\r\n        this.$toast('请选择楼层！');\r\n        return;\r\n      }\r\n      if (this.visitorData.roomName === '') {\r\n        this.$toast('请选择宿舍！');\r\n        return;\r\n      }\r\n      if (this.visitorData.stuName === '') {\r\n        this.$toast('请选择拜访人！');\r\n        return;\r\n      }\r\n      if (this.visitorData.visitTime === '') {\r\n        this.$toast('请选择检查时间！');\r\n        return;\r\n      }\r\n      this.postVisitor();\r\n    },\r\n  },\r\n  mounted() {\r\n    this.getCampus();\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.apartmentVisitor {\r\n  padding-top: 46px;\r\n}\r\n.btn-group{\r\n  padding: 0 38px;\r\n  margin: 20px 0;\r\n  .btn{\r\n      font-size: 17px;\r\n      margin: 0 auto 15px;\r\n      border-radius: 30px;\r\n      height: 6.8vh;\r\n      line-height: 6.8vh;\r\n      background-color: #FFFFFF;\r\n      color: #1890ff;\r\n      border: 1px solid #1890FF;\r\n  }\r\n  .blue{\r\n      background-color: #1890ff;\r\n      color: #FFFFFF;\r\n  }\r\n}\r\n</style>\r\n"]}]}