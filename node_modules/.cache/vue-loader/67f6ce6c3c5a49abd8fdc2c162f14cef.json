{"remainingRequest":"E:\\vue\\school\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\vue\\school\\src\\views\\application\\health\\onlineBooking.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\vue\\school\\src\\views\\application\\health\\onlineBooking.vue","mtime":1543286272000},{"path":"E:\\vue\\school\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1535070530000},{"path":"E:\\vue\\school\\node_modules\\babel-loader\\lib\\index.js","mtime":1539569622000},{"path":"E:\\vue\\school\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1535070530000},{"path":"E:\\vue\\school\\node_modules\\vue-loader\\lib\\index.js","mtime":1539569642000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { mapGetters } from 'vuex';\r\nimport { getStuOnLine, addRecord, stuInfo, dutyTime, jPush } from '@/services/health';\r\nimport noData from '@/components/noData/noData.vue';\r\nimport backButton from '@/components/backButton/backButton.vue';\r\n\r\nexport default {\r\n  name: 'onlineBooking',\r\n  data() {\r\n    return {\r\n      defaultImg: `this.src=\"${require('@/assets/tx@2x.png')}\"`,\r\n      loading: false,\r\n      finished: false,\r\n      pageNum: 0,\r\n      list: [],\r\n      stu: {},\r\n      state: '',\r\n      duty: {\r\n        type: 'dutyTime',\r\n      },\r\n      time: {},\r\n      address: {},\r\n      add: {\r\n        planId: '', // 选择的对象的id\r\n        schoolId: '', // 校区标识\r\n        deptId: '', // 院系标识\r\n        deptName: '', // 院系名称\r\n        professionId: '', // 专业标识\r\n        professionName: '', // 专业名称\r\n        classId: '', // 班级标识\r\n        className: '', // 班级名称\r\n        gradeId: '', // 年级标识\r\n        gradeName: '', // 年级名称\r\n        stuId: '', // 学生标识\r\n        stuName: '', // 学生名称\r\n        stuSexCode: '', // 性别code（1男2女）\r\n        stuSexText: '', // 性别Text\r\n        appointDurationCode: '', // 预约时间段\r\n        appointDurationText: '', // 预约时段值\r\n        isAppoint: '', // 预约状态(0未约1已约2预约取消)\r\n      },\r\n      jPushData: {\r\n        userId: '',\r\n        mk: 'xljk',\r\n        message: '',\r\n      },\r\n    };\r\n  },\r\n  components: {\r\n    'no-data': noData,\r\n    backButton,\r\n  },\r\n  computed: {\r\n    ...mapGetters('system', ['userInfo']),\r\n    // param() {\r\n    //   return {\r\n    //     stuId: this.userInfo.id,\r\n    //   };\r\n    // },\r\n  },\r\n  methods: {\r\n    onClickLeft() {\r\n      this.$router.go(-1);\r\n    },\r\n    async getDutyTime() {\r\n      const { data } = await dutyTime(this.duty);\r\n      [this.time] = data.dutyArea;\r\n      [this.address] = data.dutyDate;\r\n    },\r\n    // async getOnLine(msg) {\r\n    //   const data = await getStuOnLine(msg);\r\n    //   this.list = data.data;\r\n    // },\r\n    async onLoad() {\r\n      const data = await getStuOnLine({\r\n        stuId: this.userInfo.id,\r\n        pageNum: this.pageNum += 1,\r\n      });\r\n      this.list = this.list.concat(data.data);\r\n      // 加载状态结束\r\n      this.loading = false;\r\n      // 数据全部加载完成\r\n      if (this.list.length >= data.total) {\r\n        this.finished = true;\r\n      }\r\n    },\r\n    async getStuInfo() {\r\n      const { data } = await stuInfo({ stuId: this.userInfo.id });\r\n      [this.stu] = data;\r\n    },\r\n    async onLine(item, msg) {\r\n      const data = await addRecord(msg);\r\n      if (data.htppCode === '200' || 200) {\r\n        this.$toast.success('预约成功');\r\n      } else {\r\n        this.$toast(data.msg);\r\n      }\r\n      this.jPushData.userId = item.userId;\r\n      await jPush(this.jPushData);\r\n      this.$router.go(-1);\r\n    },\r\n    addOnline(item) {\r\n      if (item.isAppointment === '预约') {\r\n        this.state = '1';\r\n        this.jPushData.message = `${this.stu.userName}预约了${this.$moment(item.dutyDate).format('YYYY年MM月DD日')}的心理咨询。`;\r\n      } else if (item.isAppointment === '取消预约') {\r\n        this.state = '2';\r\n        this.jPushData.message = `${this.stu.userName}取消了${this.$moment(item.dutyDate).format('YYYY年MM月DD日')}的心理咨询。`;\r\n      }\r\n      this.add = {\r\n        planId: item.id, // 选择的对象的id\r\n        schoolId: this.stu.schoolId, // 校区标识\r\n        deptId: this.stu.orgId, // 院系标识\r\n        deptName: this.stu.DWMC, // 院系名称\r\n        professionId: this.stu.proId, // 专业标识\r\n        professionName: this.stu.ZYMC, // 专业名称\r\n        classId: this.stu.classId, // 班级标识\r\n        className: this.stu.BJMC, // 班级名称\r\n        gradeId: this.stu.gradeId, // 年级标识\r\n        gradeName: this.stu.gradeName, // 年级名称\r\n        stuId: this.stu.id, // 学生标识\r\n        stuName: this.stu.userName, // 学生名称\r\n        stuSexCode: this.stu.XBM, // 性别code（1男2女）\r\n        stuSexText: this.stu.XBMTEXT, // 性别Text\r\n        appointDurationCode: item.code, // 预约时间段\r\n        appointDurationText: item.codeText, // 预约时段值\r\n        isAppoint: this.state, // 预约状态(0未约1已约2预约取消)\r\n      };\r\n      this.onLine(item, this.add);\r\n    },\r\n  },\r\n  mounted() {\r\n    // this.getOnLine(this.param);\r\n    this.getStuInfo();\r\n    this.getDutyTime();\r\n  },\r\n};\r\n",{"version":3,"sources":["onlineBooking.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoDA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"onlineBooking.vue","sourceRoot":"src\\views\\application\\health","sourcesContent":["<template>\r\n  <div class=\"onlineBooking\">\r\n    <back-button></back-button>\r\n    <van-nav-bar\r\n      title=\"在线预约\"\r\n      left-text=\"返回\"\r\n      left-arrow\r\n      fixed\r\n      @click-left=\"onClickLeft\"/>\r\n    <div class=\"top address\">\r\n      <div v-if=\"this.time != ''\">咨询地点：<span>{{this.time.codeText}}</span></div>\r\n      <div v-if=\"this.address != ''\">咨询时间：<span>{{this.address.codeText}}</span></div>\r\n    </div>\r\n    <div class=\"top\">\r\n      <van-list\r\n        v-model=\"loading\"\r\n        :finished=\"finished\"\r\n        :offset= \"10\"\r\n        @load=\"onLoad\"\r\n      >\r\n      <div class=\"personal-info between\"\r\n      v-for=\"(item, index) in list\" :key=\"index\">\r\n        <div class=\"avatar\">\r\n          <img :src=\"$store.state.system.sftpPath + item.zp\"\r\n          :onerror=\"defaultImg\" alt=\"\">\r\n        </div>\r\n        <div class=\"info\">\r\n          <div class=\"con\">\r\n            <div class=\"name\">姓名：{{item.userName}}</div>\r\n            <div class=\"result\">值班日期：{{item.dutyDate}}</div>\r\n            <div class=\"result\">时间段：{{item.codeText}}</div>\r\n            <div class=\"result\">\r\n              预约状态：{{item.isAppointment === '预约' ? '' : item.isAppointment === '取消预约' ? '预约' : ''}}\r\n            </div>\r\n          </div>\r\n          <div class=\"btn-group\" v-if=\"item.isAppointment != '' && item.isAppointment != null\">\r\n            <van-button size=\"small\" class=\"btn\"\r\n            @click=\"addOnline(item)\">\r\n              {{item.isAppointment}}\r\n            </van-button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      </van-list>\r\n    </div>\r\n    <div v-if=\"this.list.length == 0\">\r\n      <no-data></no-data>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { mapGetters } from 'vuex';\r\nimport { getStuOnLine, addRecord, stuInfo, dutyTime, jPush } from '@/services/health';\r\nimport noData from '@/components/noData/noData.vue';\r\nimport backButton from '@/components/backButton/backButton.vue';\r\n\r\nexport default {\r\n  name: 'onlineBooking',\r\n  data() {\r\n    return {\r\n      defaultImg: `this.src=\"${require('@/assets/tx@2x.png')}\"`,\r\n      loading: false,\r\n      finished: false,\r\n      pageNum: 0,\r\n      list: [],\r\n      stu: {},\r\n      state: '',\r\n      duty: {\r\n        type: 'dutyTime',\r\n      },\r\n      time: {},\r\n      address: {},\r\n      add: {\r\n        planId: '', // 选择的对象的id\r\n        schoolId: '', // 校区标识\r\n        deptId: '', // 院系标识\r\n        deptName: '', // 院系名称\r\n        professionId: '', // 专业标识\r\n        professionName: '', // 专业名称\r\n        classId: '', // 班级标识\r\n        className: '', // 班级名称\r\n        gradeId: '', // 年级标识\r\n        gradeName: '', // 年级名称\r\n        stuId: '', // 学生标识\r\n        stuName: '', // 学生名称\r\n        stuSexCode: '', // 性别code（1男2女）\r\n        stuSexText: '', // 性别Text\r\n        appointDurationCode: '', // 预约时间段\r\n        appointDurationText: '', // 预约时段值\r\n        isAppoint: '', // 预约状态(0未约1已约2预约取消)\r\n      },\r\n      jPushData: {\r\n        userId: '',\r\n        mk: 'xljk',\r\n        message: '',\r\n      },\r\n    };\r\n  },\r\n  components: {\r\n    'no-data': noData,\r\n    backButton,\r\n  },\r\n  computed: {\r\n    ...mapGetters('system', ['userInfo']),\r\n    // param() {\r\n    //   return {\r\n    //     stuId: this.userInfo.id,\r\n    //   };\r\n    // },\r\n  },\r\n  methods: {\r\n    onClickLeft() {\r\n      this.$router.go(-1);\r\n    },\r\n    async getDutyTime() {\r\n      const { data } = await dutyTime(this.duty);\r\n      [this.time] = data.dutyArea;\r\n      [this.address] = data.dutyDate;\r\n    },\r\n    // async getOnLine(msg) {\r\n    //   const data = await getStuOnLine(msg);\r\n    //   this.list = data.data;\r\n    // },\r\n    async onLoad() {\r\n      const data = await getStuOnLine({\r\n        stuId: this.userInfo.id,\r\n        pageNum: this.pageNum += 1,\r\n      });\r\n      this.list = this.list.concat(data.data);\r\n      // 加载状态结束\r\n      this.loading = false;\r\n      // 数据全部加载完成\r\n      if (this.list.length >= data.total) {\r\n        this.finished = true;\r\n      }\r\n    },\r\n    async getStuInfo() {\r\n      const { data } = await stuInfo({ stuId: this.userInfo.id });\r\n      [this.stu] = data;\r\n    },\r\n    async onLine(item, msg) {\r\n      const data = await addRecord(msg);\r\n      if (data.htppCode === '200' || 200) {\r\n        this.$toast.success('预约成功');\r\n      } else {\r\n        this.$toast(data.msg);\r\n      }\r\n      this.jPushData.userId = item.userId;\r\n      await jPush(this.jPushData);\r\n      this.$router.go(-1);\r\n    },\r\n    addOnline(item) {\r\n      if (item.isAppointment === '预约') {\r\n        this.state = '1';\r\n        this.jPushData.message = `${this.stu.userName}预约了${this.$moment(item.dutyDate).format('YYYY年MM月DD日')}的心理咨询。`;\r\n      } else if (item.isAppointment === '取消预约') {\r\n        this.state = '2';\r\n        this.jPushData.message = `${this.stu.userName}取消了${this.$moment(item.dutyDate).format('YYYY年MM月DD日')}的心理咨询。`;\r\n      }\r\n      this.add = {\r\n        planId: item.id, // 选择的对象的id\r\n        schoolId: this.stu.schoolId, // 校区标识\r\n        deptId: this.stu.orgId, // 院系标识\r\n        deptName: this.stu.DWMC, // 院系名称\r\n        professionId: this.stu.proId, // 专业标识\r\n        professionName: this.stu.ZYMC, // 专业名称\r\n        classId: this.stu.classId, // 班级标识\r\n        className: this.stu.BJMC, // 班级名称\r\n        gradeId: this.stu.gradeId, // 年级标识\r\n        gradeName: this.stu.gradeName, // 年级名称\r\n        stuId: this.stu.id, // 学生标识\r\n        stuName: this.stu.userName, // 学生名称\r\n        stuSexCode: this.stu.XBM, // 性别code（1男2女）\r\n        stuSexText: this.stu.XBMTEXT, // 性别Text\r\n        appointDurationCode: item.code, // 预约时间段\r\n        appointDurationText: item.codeText, // 预约时段值\r\n        isAppoint: this.state, // 预约状态(0未约1已约2预约取消)\r\n      };\r\n      this.onLine(item, this.add);\r\n    },\r\n  },\r\n  mounted() {\r\n    // this.getOnLine(this.param);\r\n    this.getStuInfo();\r\n    this.getDutyTime();\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n  .onlineBooking{\r\n    padding:46px 0 60px;\r\n  }\r\n  .success {\r\n    color: #51bf61 !important;\r\n  }\r\n  .warning{\r\n    color: #ea9542 !important;\r\n  }\r\n  .danger{\r\n    color: #ff5757 !important;\r\n  }\r\n  .between{\r\n    margin:0 12px;\r\n  }\r\n  .top{\r\n    margin-top: 11px;\r\n    background: #fff;\r\n  }\r\n  .address{\r\n    padding:10px 12px;\r\n    >div{\r\n      line-height: 30px;\r\n      color:#333;\r\n      font-size: 14px;\r\n      >span{\r\n        color:#777;\r\n      }\r\n    }\r\n  }\r\n  .personal-info{\r\n    padding:20px 0px 0px;\r\n    overflow: hidden;\r\n    position: relative;\r\n    .avatar{\r\n      width: 48px;\r\n      height: 48px;\r\n      border-radius: 50%;\r\n      overflow: hidden;\r\n      margin-right: 14px;\r\n      float: left;\r\n    }\r\n    .info{\r\n      width:calc(100% - 62px);\r\n      float: left;\r\n      border-bottom:1px solid #e7e7e7;\r\n      .name{\r\n        font-size: 16px;\r\n        color: #333;\r\n        margin-bottom: 6px;\r\n      }\r\n      .result{\r\n        font-size: 15px;\r\n        color:#999;\r\n        line-height: 25px;\r\n      }\r\n    }\r\n    &:last-child{\r\n      .info{\r\n        border: 0;\r\n      }\r\n    }\r\n    .con{\r\n      float: left;\r\n      padding-bottom: 20px;\r\n    }\r\n    .date{\r\n      font-size: 14px;\r\n      color:#999;\r\n      float: right;\r\n    }\r\n    .btn-group{\r\n        position: absolute;\r\n        bottom: 20px;\r\n        right: 0;\r\n        .btn{\r\n            font-size: 16px;\r\n            border-radius: 2px;\r\n            background-color: #1890ff;\r\n            color: #FFFFFF;\r\n            padding: 0px 12px;\r\n        }\r\n    }\r\n  }\r\n</style>\r\n"]}]}