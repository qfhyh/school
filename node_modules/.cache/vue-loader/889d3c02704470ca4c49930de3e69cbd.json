{"remainingRequest":"F:\\青峰软件\\通用平台\\2018教务\\vueProject\\school\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\青峰软件\\通用平台\\2018教务\\vueProject\\school\\src\\components\\upload\\uploadImg.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\青峰软件\\通用平台\\2018教务\\vueProject\\school\\src\\components\\upload\\uploadImg.vue","mtime":1543458639907},{"path":"F:\\青峰软件\\通用平台\\2018教务\\vueProject\\school\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1543456662663},{"path":"F:\\青峰软件\\通用平台\\2018教务\\vueProject\\school\\node_modules\\babel-loader\\lib\\index.js","mtime":1543456662314},{"path":"F:\\青峰软件\\通用平台\\2018教务\\vueProject\\school\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1543456662663},{"path":"F:\\青峰软件\\通用平台\\2018教务\\vueProject\\school\\node_modules\\vue-loader\\lib\\index.js","mtime":1543456678579}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { uploadFile } from '@/services/api';\r\n\r\nexport default {\r\n  name: 'upload-img',\r\n  data() {\r\n    return {\r\n      step: 0,\r\n      imgUrl: '',\r\n      imgList: [],\r\n    };\r\n  },\r\n  methods: {\r\n    // 上传图片\r\n    async uploaded(img, imgData) {\r\n      const config = {\r\n        onUploadProgress: (progressEvent) => {\r\n          const complete = (progressEvent.loaded / progressEvent.total) * 100 || 0;\r\n          this.step = complete;\r\n        },\r\n      };\r\n      const formData = new FormData();\r\n      formData.append('file', img);\r\n      const data = await uploadFile(formData, config);\r\n      if (data && (data.httpCode === 200 || '200')) {\r\n        this.imgList.push(imgData);\r\n        this.$emit('imgData', data.data);\r\n      } else {\r\n        this.$toast('网络错误，请重新上传！');\r\n      }\r\n    },\r\n    readImg(files, content) {\r\n      // 预览图片\r\n      const img = {};\r\n      img.src = window.URL.createObjectURL(files.file);\r\n      img.onload = function onload() {\r\n        window.URL.revokeObjectURL(this.src);\r\n      };\r\n      img.name = files.file.name;\r\n      this.uploaded(files.file, img);\r\n    },\r\n    deleteImg(index) {\r\n      this.imgList.splice(index, 1);\r\n    },\r\n  },\r\n};\r\n",{"version":3,"sources":["uploadImg.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAmBA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"uploadImg.vue","sourceRoot":"src\\components\\upload","sourcesContent":["<template>\r\n  <div class=\"upload\">\r\n    <ul>\r\n      <li v-for=\"(img, index) in imgList\" :key=\"index\">\r\n        <img class=\"upimg\" :src=\"img.src\" alt=\"\">\r\n        <van-icon name=\"close\" class=\"close\" @click=\"deleteImg(index)\"/>\r\n        <van-progress :percentage=\"step\" :show-pivot=\"false\" v-if=\"step\"/>\r\n      </li>\r\n      <li>\r\n        <van-uploader :after-read=\"readImg\" multiple>\r\n          <div class=\"pos\">\r\n            <span>+</span>\r\n          </div>\r\n        </van-uploader>\r\n      </li>\r\n    </ul>\r\n  </div>\r\n</template>\r\n<script>\r\nimport { uploadFile } from '@/services/api';\r\n\r\nexport default {\r\n  name: 'upload-img',\r\n  data() {\r\n    return {\r\n      step: 0,\r\n      imgUrl: '',\r\n      imgList: [],\r\n    };\r\n  },\r\n  methods: {\r\n    // 上传图片\r\n    async uploaded(img, imgData) {\r\n      const config = {\r\n        onUploadProgress: (progressEvent) => {\r\n          const complete = (progressEvent.loaded / progressEvent.total) * 100 || 0;\r\n          this.step = complete;\r\n        },\r\n      };\r\n      const formData = new FormData();\r\n      formData.append('file', img);\r\n      const data = await uploadFile(formData, config);\r\n      if (data && (data.httpCode === 200 || '200')) {\r\n        this.imgList.push(imgData);\r\n        this.$emit('imgData', data.data);\r\n      } else {\r\n        this.$toast('网络错误，请重新上传！');\r\n      }\r\n    },\r\n    readImg(files, content) {\r\n      // 预览图片\r\n      const img = {};\r\n      img.src = window.URL.createObjectURL(files.file);\r\n      img.onload = function onload() {\r\n        window.URL.revokeObjectURL(this.src);\r\n      };\r\n      img.name = files.file.name;\r\n      this.uploaded(files.file, img);\r\n    },\r\n    deleteImg(index) {\r\n      this.imgList.splice(index, 1);\r\n    },\r\n  },\r\n};\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n  .upload {\r\n    .upimg {\r\n      width: 50px;\r\n      height: 50px;\r\n    }\r\n    .close {\r\n      position: absolute;\r\n      top: -8px;\r\n      right: -8px;\r\n      background: #fff;\r\n      border-radius: 8px;\r\n    }\r\n    ul {\r\n      background-color: #fff;\r\n      overflow: hidden;\r\n      li {\r\n        float: left;\r\n        margin: 15px;\r\n        position: relative;\r\n      }\r\n    }\r\n    .pos{\r\n      width: 50px;\r\n      height: 50px;\r\n      text-align: center;\r\n      span{\r\n        background: #e7e7ea;\r\n        color:#fff;\r\n        padding: 0 12px;\r\n        font-size: 45px;\r\n      }\r\n    }\r\n  }\r\n</style>\r\n"]}]}