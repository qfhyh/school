<template>
  <div id="app" class="container mt-5">
    <h1 class="border-bottom pb-2 mb-4">Vue pivot table demo</h1>

    <div class="mb-5">
      <pivot :data="data" :fields="fields" :row-fields="rowFields" :col-fields="colFields" :reducer="reducer">
        <template slot="widget" slot-scope="{ value }">
          {{ widgetFormatter(value) }}
        </template>
        <template slot="action" slot-scope="{ value }">
          {{ actionFormatter(value) }}
        </template>
        <template slot="retailer" slot-scope="{ value }">
          {{ retailerFormatter(value) }}
        </template>
        <template slot="value" slot-scope="{ value }">
          {{ value.toLocaleString() }}
        </template>
      </pivot>
    </div>
  </div>
</template>

<script>
import Pivot from '../src/Pivot'
import data from './data_c2b'
import _widgetsData from './widgets_data'
const widgetsData = _widgetsData
import _retailersData from './retailers_data'
const retailersData = _retailersData

export default {
  name: 'app',
  components: { Pivot },
  data: () => {
    return {
      data: Object.freeze(data),
      fields: [{
        getter: item => item._id.source,
        label: 'Source'
      }, {
        getter: item => item._id.device,
        label: 'Device'
      }],
      colFields: [{
        getter: item => item._id.action,
        label: 'Action',
        sort: (a, b) => {
          const actionsOrdered = ['print_button', 'print', 'injection', 'redirection']
          if (actionsOrdered.indexOf(a) < 0) {
            return 1
          } else if (actionsOrdered.indexOf(b) < 0) {
            return -1
          } else {
            return actionsOrdered.indexOf(a) - actionsOrdered.indexOf(b)
          }
        },
        headerSlotName: 'action'
      }, {
        getter: item => item._id.retailerId,
        label: 'Retailer',
        headerSlotName: 'retailer'
      }],
      rowFields: [{
        getter: item => item._id.mediumId,
        label: 'Widget',
        headerSlotName: 'widget'
      }],
      reducer: function(sum, item) {
        return sum + item.count
      }
    }
  },
  methods: {
    actionFormatter: function(value) {
      switch (value) {
        case 'print_button':
          return 'Affichage bouton'
        case 'print':
          return 'Clic'
        case 'injection':
          return 'Injection'
        case 'redirection':
          return 'Redirection'
        case 'validation':
          return 'Validation'
      }
    },
    widgetFormatter: function(value) {
      const widget = widgetsData.find(widget => widget.id == value)
      return widget ? widget.name : '-'
    },
    retailerFormatter: function(value) {
      const retailer = retailersData.find(retailer => retailer.id == value)
      return retailer ? retailer.name : '-'
    }
  }
}
</script>

<style lang="scss">
$enable-rounded: false;
@import '~bootstrap/scss/bootstrap.scss';
</style>
